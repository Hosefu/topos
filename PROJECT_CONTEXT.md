# Контекст проекта "Интерактивная карта офиса с бронированием столов"

## Обзор проекта

Проект представляет собой веб-приложение для визуализации и управления рабочими местами в офисе с возможностью их бронирования. Разработан для решения проблемы нестабильного посещения офиса сотрудниками и эффективного распределения рабочих мест.

## Архитектура

Проект построен на архитектуре клиент-сервер с разделением на бэкенд и фронтенд части.

### Бэкенд (Django)

- **Django + Django REST Framework**: основной фреймворк для бэкенда
- **Django Channels**: для WebSocket соединений и обновлений в реальном времени
- **Celery**: для выполнения фоновых и периодических задач
- **PostgreSQL**: база данных для хранения информации
- **Redis**: для кеширования и брокера сообщений

#### Основные приложения:

1. **users**: Управление пользователями, авторизация через Telegram
2. **desks**: Управление рабочими местами и их статусами
3. **reservations**: Система бронирования с поддержкой разных типов бронирований
4. **office_layout**: Управление схемами офиса и их элементами
5. **core**: Общие функции и WebSocket обработчики

### Фронтенд (React)

- **React.js**: основной фреймворк для интерфейса пользователя
- **Redux Toolkit**: управление состоянием приложения
- **React Konva**: для интерактивной карты офиса
- **Tailwind CSS**: для стилизации компонентов
- **Axios**: для HTTP-запросов к API

#### Основные компоненты:

1. **Страницы**: Dashboard, OfficeMap, Reservations, Profile
2. **Компоненты карты**: OfficeMap, DeskDetail
3. **Компоненты бронирований**: ReservationCard, CreateReservationModal
4. **Общие компоненты**: DatePicker, TimeRangePicker, FilterTabs, LoadingSpinner

### Инфраструктура

- **Docker и Docker Compose**: для контейнеризации и управления сервисами
- **Nginx**: в качестве reverse proxy

## Основные функции

1. **Авторизация через Telegram**: Пользователи входят в систему с помощью Telegram Login Widget
2. **Интерактивная карта офиса**: Визуализация рабочих мест с индикацией их статуса
3. **Бронирование столов**: Возможность забронировать стол на определенную дату и время
4. **Повторяющиеся бронирования**: Поддержка регулярных бронирований (ежедневно, еженедельно и т.д.)
5. **Календарь бронирований**: Просмотр текущих и предстоящих бронирований
6. **Отметка о прибытии**: Подтверждение, что пользователь прибыл на рабочее место
7. **Профиль пользователя**: Управление личными данными и предпочтениями
8. **Статистика**: Отображение статистики использования офиса
9. **Уведомления**: Система уведомлений о бронированиях и важных событиях
10. **Обновления в реальном времени**: WebSocket для мгновенного обновления данных

## Модели данных

### User
- Расширенная модель пользователя с поддержкой Telegram
- Предпочтения по рабочим местам

### Desk
- Рабочее место с его координатами на карте
- Статус (доступен, занят, зарезервирован, на обслуживании)
- Тип стола и особенности (монитор, регулировка высоты и т.д.)

### Area
- Зона офиса (этаж, отдел и т.д.)

### Reservation
- Бронирование стола пользователем
- Время начала и окончания бронирования
- Тип бронирования (однократное, повторяющееся)
- Шаблон повторения для регулярных бронирований

### OfficeLayout
- Схема офиса с размерами и фоновым изображением
- Элементы схемы (стены, двери, окна и т.д.)

## API Endpoints

### Пользователи
- `/api/users/telegram-login/`: Авторизация через Telegram
- `/api/users/me/`: Информация о текущем пользователе
- `/api/users/preferences/`: Управление предпочтениями пользователя

### Рабочие места
- `/api/desks/`: Список всех столов
- `/api/desks/{id}/`: Управление конкретным столом
- `/api/desks/available/`: Получение доступных столов на дату
- `/api/desks/areas/`: Список зон офиса

### Бронирования
- `/api/reservations/`: Список и создание бронирований
- `/api/reservations/{id}/`: Управление конкретным бронированием
- `/api/reservations/current/`: Текущее активное бронирование
- `/api/reservations/upcoming/`: Предстоящие бронирования
- `/api/reservations/{id}/check_in/`: Отметка о прибытии
- `/api/reservations/{id}/cancel/`: Отмена бронирования

### Схема офиса
- `/api/office/layouts/`: Список схем офиса
- `/api/office/layouts/{id}/`: Управление конкретной схемой
- `/api/office/elements/`: Элементы схемы офиса
- `/api/office/stats/`: Статистика по офису

### WebSocket
- `/ws/office/{token}/`: WebSocket для обновлений в реальном времени

## Процесс разработки

1. **Настройка окружения**: Создание Docker-контейнеров для бэкенда и фронтенда
2. **Разработка бэкенда**: Реализация API и моделей данных
3. **Разработка фронтенда**: Создание интерфейса пользователя и интеграция с API
4. **Настройка WebSocket**: Обеспечение обновлений в реальном времени
5. **Тестирование**: Проверка работоспособности всех функций
6. **Деплой**: Развертывание приложения

## Инструкции по запуску

1. Клонировать репозиторий
2. Создать файл `.env` на основе `.env.example`
3. Настроить Telegram бота
4. Запустить с помощью `docker-compose up -d`
5. Создать суперпользователя Django
6. Настроить схему офиса и зоны в админ-панели

## Полезные команды

```bash
# Запуск проекта
docker-compose up -d

# Остановка проекта
docker-compose down

# Просмотр логов
docker-compose logs -f

# Выполнение миграций
docker-compose exec backend python manage.py migrate

# Создание суперпользователя
docker-compose exec backend python manage.py createsuperuser

# Сборка фронтенда для продакшена
docker-compose exec frontend npm run build
```

## Контактная информация

Если у вас возникли вопросы по проекту, свяжитесь с нами:
- Сайт: [example.com](https://example.com)
- Email: support@example.com